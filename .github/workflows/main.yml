name: Crate BM digital contacts 

on:
  schedule:
      - cron: '0 22 * * *'
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Setup Python Environment
        uses: actions/setup-python@v2
        with:
          python-version: 3.7

      - name: Install Requirements
        run: pip3 install -r requirements.txt

      - name: Generate BM digital contacts for whole world
        run: |
          python3 brandmeister-digital-contacts.py World


      - name: Generate BM digital contacts for Ukraine
        run: |
          python3 brandmeister-digital-contacts.py Ukraine


      - name: Generate BM digital contacts for RB 
        run: |
          python3 brandmeister-digital-contacts.py Belarus
          

      - name: Create directory listing 
        run: tree -P "*.csv" -H '.' --charset utf-8 > index.html
               
      - name: setup git config
        run: |
          git config user.name ${{ secrets.USERNAME }}
          git config user.email ${{ secrets.EMAIL }}

      - name: commit changes
        run: |
          chmod +x ./commit.sh
          ./commit.sh
          
           
      - name: Send mail
        if: always()
        uses: dawidd6/action-send-mail@v2
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{secrets.EMAIL_USERNAME}}
          password: ${{secrets.EMAIL_PASSWORD}}
          subject: Github Actions job result ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }}
          body: Build job of ${{ github.job }} job in worflow ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }}
          to: shaposhnikoff@gmail.com
          from: Maksym Shaposhnikov 
          content_type: text/html
          convert_markdown: true
